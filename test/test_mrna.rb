require 'mrna'
require 'genome_fap'
require "test/unit"
 
class TestMrna < Test::Unit::TestCase
 	
	def setup
		@mrna = Mrna.new("NM_001109719", "chr1", "+", 2469741, 2673265, 2469990, 2673265, 4, [2469741,2546653,2642202,2673100], [2470146,2546811,2642593,2673265], "zgc:171629", "glypican-6 precursor", "NM_001109719", "NP_001103189")
		@unannotated_mrna = Mrna.new("NM_198142-46|chr22(+)", "chr22", "+", 19153513,	19169789,	19153659,	19166648,	8,	[19153513,19159091,19160361,19161428,19162707,19166428,19166587,19169625],	[19153729,19159257,19160450,19161565,19162987,19166453,19166661,19169789],	"bsg",	"basigin precursor",	"NM_198142",	"NM_198142-46|chr22(+)")
		@danRer7_refseq_fap = GenomeFastaParser.new("../data/danRer7.fa")
	end
	
	def test_mrnas
		assert_kind_of(Mrna, @mrna)
	end

	def test_genome_fap
		assert_kind_of(GenomeFastaParser, @danRer7_refseq_fap)
	end

	def test_mrna
		assert_equal("NP_001103189", @mrna.prot_accno)
	end
	
	def test_cds_length
		assert_equal(874, @mrna.cds_length)
	end

	def test_cds_to_bed
		assert_equal("chr1\t2469990\t2673266\tNM_001109719\t1\t+\t2469990\t2673266\t0,255,0\t4\t157,159,392,166\t0,76663,172212,203110", @mrna.cds_to_bed)
	end

	def test_cds_to_fasta
		assert_equal("ATGGTGAAGACACCTGTCGTGGTTTTTACTTCTTTATCGCTTCTGCTGTCGCTGTCATGTGCTGGAGATGTAAAATCGCGCAGCTGCAGCGATGTGCGCCTGGCGTTCACCACCAAAGGCTTCAGTCTCCATAATGTGCCACATCAGGAGATATCAGGTGAGCATCTGCGGGTCTGTGCTCAAGGATACACCTGCTGTACTTCAGACATAGAGGATCAGCTCGGACAGCAGAGCAAGCTGGACTTCGAGAGGCTGGTGGACGACAGCAGCAGGAACATACGCACAACATTCACCTCCAGACACAAAAAGTTTGACGAGTTTTTCCTGGAGTTGCTGGACAACTCTGAGAAGTCTCTAAACGACATGTTTGTGCGCACATATGGCAAACTCTACACACACAACTCGGAGATGTTCGAGGACCTGTTCTCAGAGCTGAAGCGCTACTACACCGGTGGGAACGTCAACCTGGAGGAGGTGCTGAATGACTTCTGGTCGCGTCTGCTGGAGAGAATGTTCCAGCTGCTCAACTCGCAGTTCACCTTCAGCGACGACTATCTGGAGTGCATCAGCAAATACACTGACCAGCTCAAGCCGTTCGGAGACGTGCCGCGAAAACTCAAGGCGCAGGTCACCAAAGCTTTCATCGCGGCCAGATCCTTCGTCCAGGGACTTATGGTGGGCCGAGAAGTGGCCAACAGGGTGGCCAAGGTCAATATTTCTCCAGGCTGCAGTAAAGCATTGACTAAAATGTGGTACTGCCCGTATTGTGGAGGAATGTCAGGACTCAAACCCTGCGCCAACTACTGCCAGAATGTGATGCGCGGCTGCCTGGCCAACCAAGCGGATCTGGACCCTGAGTGGAACCTCTTTATTG", @mrna.cds_to_fasta(@danRer7_refseq_fap))
	end

	def cds_to_protein
		assert_equal(">NM_198142-46|chr22(+)\nMEKKLFGAVLVICIGWFQAEAMTGATIMTSPEVNNATSATLSCNLTNPSSPIKGHYWVKN\nGKKIEESYSTNTDSYAEHFIEKADYHHSGIYTCVFLTEPQANATIEVKALPHIKASKSSE\nNANEKDKAVLSCGSQGYPSPTDWSWFKLPDAGERTPIFNGTDDKYEIKSTPNKTTLYVKD\nLDINEDMGFYQCQGTSEVGTGTDDIQLRVRSQLAALWPFLGIVAEVIILITIIFVYEKRR\nKPDEINDDDDSGSAPLKSNSATNHKDKNVRQRNSN*", @unannotated_mrna.cds_to_protein(danRer7_refseq_fap))
	end

	def cds_to_mrnarefseq
		assert_equal("NM_001002866-13|chr19(+)	chr19	+	49957401	49963584	49957425	49963556	5	49957401,49958691,49960225,49960768,49963490	49957428,49958793,49960320,49960868,49963584	rpl14	60S ribosomal protein L14	NM_001002866	NM_001002866-13|chr19(+)", @unannotated_mrna.cds_to_mrnarefseq)
	end

end
#OK